{% extends "base.html" %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1><i class="fas fa-server me-2"></i>System Status</h1>
            <button class="btn btn-outline-primary" onclick="location.reload()">
                <i class="fas fa-sync-alt me-1"></i>Refresh
            </button>
        </div>
    </div>
</div>

<!-- System Overview -->
<div class="row mb-4">
    <div class="col-md-3">
        <div class="card bg-primary text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <div>
                        <h5>Total Sensors</h5>
                        <h3>{{ sensor_stats.total }}</h3>
                    </div>
                    <div class="align-self-center">
                        <i class="fas fa-microchip fa-2x"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card bg-success text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <div>
                        <h5>Active</h5>
                        <h3>{{ sensor_stats.active }}</h3>
                    </div>
                    <div class="align-self-center">
                        <i class="fas fa-check-circle fa-2x"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card bg-danger text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <div>
                        <h5>Errors</h5>
                        <h3>{{ sensor_stats.error }}</h3>
                    </div>
                    <div class="align-self-center">
                        <i class="fas fa-exclamation-triangle fa-2x"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card bg-info text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <div>
                        <h5>Recent Readings</h5>
                        <h3>{{ recent_readings }}</h3>
                        <small>Last 24 hours</small>
                    </div>
                    <div class="align-self-center">
                        <i class="fas fa-chart-bar fa-2x"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- System Status Details -->
{% if system_status %}
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-info-circle me-2"></i>System Information</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <table class="table table-sm">
                            <tr>
                                <td><strong>CPU Usage:</strong></td>
                                <td>{{ "%.1f"|format(system_status.cpu_usage) }}%</td>
                            </tr>
                            <tr>
                                <td><strong>Memory Usage:</strong></td>
                                <td>{{ "%.1f"|format(system_status.memory_usage) }}%</td>
                            </tr>
                            <tr>
                                <td><strong>Disk Usage:</strong></td>
                                <td>{{ "%.1f"|format(system_status.disk_usage) }}%</td>
                            </tr>
                        </table>
                    </div>
                    <div class="col-md-6">
                        <table class="table table-sm">
                            <tr>
                                <td><strong>Temperature:</strong></td>
                                <td>{{ "%.1f"|format(system_status.temperature) }}Â°C</td>
                            </tr>
                            <tr>
                                <td><strong>Uptime:</strong></td>
                                <td>{{ system_status.uptime }}</td>
                            </tr>
                            <tr>
                                <td><strong>Last Updated:</strong></td>
                                <td>{{ system_status.timestamp.strftime('%Y-%m-%d %H:%M:%S UTC') }}</td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- Sensor Status -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-list me-2"></i>Sensor Details</h5>
            </div>
            <div class="card-body">
                {% if sensors %}
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Sensor ID</th>
                                <th>Name</th>
                                <th>Type</th>
                                <th>Location</th>
                                <th>Status</th>
                                <th>Last Reading</th>
                                <th>24h Readings</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for sensor in sensors %}
                            <tr>
                                <td><code>{{ sensor.id }}</code></td>
                                <td>{{ sensor.name or '-' }}</td>
                                <td>{{ sensor.sensor_type }}</td>
                                <td>{{ sensor.location or '-' }}</td>
                                <td>
                                    <span class="badge bg-{{ 'success' if sensor.status == 'active' else 'danger' if sensor.status == 'error' else 'secondary' }}">
                                        {{ sensor.status|title }}
                                    </span>
                                </td>
                                <td>
                                    {% if sensor.last_reading_at %}
                                        {{ sensor.last_reading_at.strftime('%H:%M:%S') }}
                                    {% else %}
                                        Never
                                    {% endif %}
                                </td>
                                <td>{{ readings_per_sensor.get(sensor.id, 0) }}</td>
                                <td>
                                    <a href="{{ url_for('main.sensor_detail', sensor_id=sensor.id) }}" 
                                       class="btn btn-sm btn-outline-primary">
                                        <i class="fas fa-eye me-1"></i>View
                                    </a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="text-center py-4">
                    <i class="fas fa-exclamation-circle text-muted fa-2x mb-2"></i>
                    <p class="text-muted">No sensors configured</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
